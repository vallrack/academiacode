
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AcademiaCode platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., Admin, Instructor, Student)."
        },
        "groupId": {
            "type": "string",
            "description": "Reference to the Group the student belongs to. (Relationship: Group 1:N User)"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role"
      ]
    },
    "Group": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Group",
      "type": "object",
      "description": "Represents a group or class of students.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Group entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the group (e.g., 'ADS1')."
        },
        "schedule": {
          "type": "object",
          "description": "The structured schedule for the group.",
          "properties": {
            "days": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Days of the week for the class."
            },
            "startTime": {
              "type": "string",
              "format": "time",
              "description": "Start time for the class."
            },
            "endTime": {
              "type": "string",
              "format": "time",
              "description": "End time for the class."
            }
          },
          "required": ["days", "startTime", "endTime"]
        }
      },
      "required": [
        "id",
        "name",
        "schedule"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course offered on the AcademiaCode platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Course entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the course."
        },
        "description": {
          "type": "string",
          "description": "Description of the course."
        },
        "instructorId": {
          "type": "string",
          "description": "Reference to the Instructor (User) who teaches the course. (Relationship: User 1:N Course)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "instructorId"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Represents an assignment given to students.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Assignment entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the assignment."
        },
        "description": {
          "type": "string",
          "description": "Description of the assignment."
        },
        "dueDate": {
          "type": "string",
          "description": "Due date for the assignment.",
          "format": "date-time"
        },
        "courseId": {
          "type": "string",
          "description": "Reference to the Course to which the assignment belongs. (Relationship: Course 1:N Assignment)"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "dueDate",
        "courseId"
      ]
    },
    "Submission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Submission",
      "type": "object",
      "description": "Represents a student's submission for an assignment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Submission entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student (User) who submitted the assignment. (Relationship: User 1:N Submission)"
        },
        "assignmentId": {
          "type": "string",
          "description": "Reference to the Assignment for which the submission was made. (Relationship: Assignment 1:N Submission)"
        },
        "submissionDate": {
          "type": "string",
          "description": "Date when the submission was made.",
          "format": "date-time"
        },
        "code": {
          "type": "string",
          "description": "The code submitted by the student."
        },
        "grade": {
          "type": "number",
          "description": "The grade received for the submission."
        }
      },
      "required": [
        "id",
        "studentId",
        "assignmentId",
        "submissionDate",
        "code"
      ]
    },
    "Testcase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Testcase",
      "type": "object",
      "description": "Represent the test cases that the teacher creates to test if a submission for and assignment is correct.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Testcase entity."
        },
        "input": {
          "type": "string",
          "description": "The input for the test case"
        },
        "expectedOutput": {
          "type": "string",
          "description": "The expected output for the test case"
        },
        "assignmentId": {
          "type": "string",
          "description": "Reference to the Assignment this testcase belongs to. (Relationship: Assignment 1:N Testcase)"
        }
      },
      "required": [
        "id",
        "input",
        "expectedOutput",
        "assignmentId"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who made the payment. (Relationship: User 1:N Payment)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the payment."
        },
        "paymentDate": {
          "type": "string",
          "description": "Date when the payment was made.",
          "format": "date-time"
        },
        "paymentMethod": {
          "type": "string",
          "description": "Method of payment (e.g., Credit Card, PayPal)."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to the Subscription to which the payment is associated. (Relationship: Subscription 1:N Payment)"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "paymentDate",
        "paymentMethod"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subscription entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns the subscription. (Relationship: User 1:N Subscription)"
        },
        "planName": {
          "type": "string",
          "description": "Name of the subscription plan (e.g., Basic, Premium)."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the subscription ends.",
          "format": "date-time"
        },
        "price": {
          "type": "number",
          "description": "Price of the subscription plan."
        }
      },
      "required": [
        "id",
        "userId",
        "planName",
        "startDate",
        "endDate",
        "price"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Each document is identified by a unique user ID. This collection now includes a 'groupId' field to link students to their respective group.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/groups/{groupId}",
        "definition": {
          "entityName": "Group",
          "schema": {
            "$ref": "#/backend/entities/Group"
          },
          "description": "Stores student groups or classes.",
          "params": [
            {
              "name": "groupId",
              "description": "The unique identifier of the group."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores courses offered on the AcademiaCode platform. Includes denormalized 'instructorId' for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Stores assignments for each course.  Located as a subcollection of 'courses'. Includes denormalized 'courseId' for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier of the assignment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/submissions/{submissionId}",
        "definition": {
          "entityName": "Submission",
          "schema": {
            "$ref": "#/backend/entities/Submission"
          },
          "description": "Stores submissions made by students. Located as a subcollection of 'users'. Includes denormalized 'studentId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user (student)."
            },
            {
              "name": "submissionId",
              "description": "The unique identifier of the submission."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/assignments/{assignmentId}/testcases/{testcaseId}",
        "definition": {
          "entityName": "Testcase",
          "schema": {
            "$ref": "#/backend/entities/Testcase"
          },
          "description": "Stores test cases for each assignment. Located as a subcollection of 'assignments'. Includes denormalized 'assignmentId' for authorization independence.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier of the assignment."
            },
            {
              "name": "testcaseId",
              "description": "The unique identifier of the test case."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information for each user. Located as a subcollection of 'users'. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "paymentId",
              "description": "The unique identifier of the payment."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores subscription information for each user. Located as a subcollection of 'users'. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier of the subscription."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support AcademiaCode's core features, including secure code execution, collaborative coding, and academic management, while adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. The structure prioritizes clarity, security, and scalability.\n\n**Authorization Independence:**\n\n*   Ownership and membership are explicitly modeled in each collection.  For example, the `courses` collection includes the `instructorId`. This denormalization avoids the need for `get()` calls in security rules to validate ownership or membership, enabling atomic operations and simplifying security rule design.\n\n**Structural Segregation:**\n\n*   The data is separated into collections based on entity type (e.g., `users`, `courses`, `assignments`, `submissions`, `testcases`, `payments`, `subscriptions`). This ensures that each collection has a homogeneous security posture and simplifies rule definition.  User-owned data (e.g., subscriptions, payments) are stored under the `/users/{userId}` path, providing clear ownership and access control.\n\n**Access Modeling:**\n\n*   **Private Data:** User profiles are stored under `/users/{userId}`, ensuring that only the user can access their own data.\n*   **Hierarchical Ownership:** The structure leverages hierarchical paths to represent relationships. For example, `courses` are owned by `users` (instructors), `assignments` are owned by `courses`, `submissions` are owned by both `users` (students) and `assignments`, and `testcases` are owned by `assignments`. This path-based ownership simplifies security rules and ensures data integrity.\n\n**QAPs (Rules are not Filters):**\n\n*   The structure supports secure list operations by clearly defining ownership and access rights through path-based ownership. For example, listing courses under a specific instructor (`/users/{instructorId}/courses/{courseId}`) or assignments for a course (`/courses/{courseId}/assignments/{assignmentId}`).\n\n*   By ensuring that authorization data (e.g., `instructorId` in `courses`) is present in each document, rules can efficiently validate access without querying other documents, enabling secure and efficient list operations.\n"
  }
}
